@{
    Layout = "_Layout";
}

@model WebSchool.Models.School.SchoolViewModel

<link rel="stylesheet" href="~/css/createpost.css" />

<div class="row">
    <div class="col-md-12 text-center">
        <img src="@Model.ImageUrl" height="200" class="w-100" />
        <h2 class="mt-3">@Model.Name</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-6 offset-3 text-center mt-2">
        <form method="post" asp-controller="Post" asp-action="CreatePost">
            <h3 onclick="handlePost()" id="addButton">Add new post</h3>
            <div id="postForm" style="display: none;">
                <div class="form-group" id="postForm">
                    <textarea class="form-control" placeholder="Post content" rows="5" name="content"></textarea>
                </div>
                <button class="btn btn-primary w-100" type="submit">Post</button>
            </div>
        </form>
    </div>
</div>

<ul class="list-unstyled">
    @{
        int counter = 1;
    }
    @foreach (var post in Model.Posts)
    {
        <li class="media mt-3" data-toggle="modal" data-target="#exampleModalCenter" id="post">
            <img class="mr-3" src="https://i.pinimg.com/originals/0c/3b/3a/0c3b3adb1a7530892e55ef36d3be6cb8.png" width="64" height="64">
            <div class="media-body" id="post@(counter++)">
                <input type="hidden" id="hidden" value="@post.Id" />
                <h5 class="mt-0">@post.Creator</h5>
                <p>
                    @post.Content
                </p>
            </div>
        </li>
    }
</ul>

<nav aria-label="Page navigation example" class="fixed-bottom">
    <ul class="pagination justify-content-center">
        @if (Model.Page > 1)
        {
            <li class="page-item"><a class="page-link" href="/School/Forum?page=@(Model.Page - 1)">@(Model.Page - 1) </a></li>
        }
        <li class="page-item active"><a class="page-link" href="/School/Forum?page=@(Model.Page)">@Model.Page</a></li>
        @if (Model.Page < Model.MaxPages)
        {
            <li class="page-item"><a class="page-link" href="/School/Forum?page=@(Model.Page + 1)">@(Model.Page + 1) </a></li>
        }
    </ul>
</nav>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Comments</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="list-unstyled" id="commentSection">
                    EMAIL
                    THIS IS CONTENT

                </ul>
            </div>
            <div class="modal-footer">
                <form class="w-100" method="post" id="commentForm" asp-controller="Comment" asp-action="CreateComment">
                    <input type="hidden" value="" id="formHidden" name="postId" />
                    <div class="form-group">
                        <textarea placeholder="Enter comment" class="form-control" rows="4" name="content"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Post comment</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/handlePost.js"></script>
    <script>
        const comments = document.getElementById("commentSection");

        $("#post1, #post2, #post3, #post4, #post5, #post6, #post7, #post8, #post9, #post10").click(function (event) {
            const hiddenValue = $(this).find("#hidden").val();
            const formHidden = document.getElementById("formHidden");
            formHidden.value = hiddenValue;

            let xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let data = JSON.parse(this.responseText);
                    comments.innerHTML = "";
                    if (data.length == 0) {
                        comments.innerHTML = "<p>Be the first one to write a comment ;)</p>";
                        return;
                    }

                    for (let i = 0; i < data.length; i++) {
                        comments.innerHTML += `<li class="media mt-3">` + `<img src='https://i.pinimg.com/originals/0c/3b/3a/0c3b3adb1a7530892e55ef36d3be6cb8.png' class='mr-3'  width='64' height='64'/>` + `<div class="media-body"><h5 class="mt-0">` + data[i].creator + `</h5><p>` + data[i].content + `</p></div></li>`;
                    }
                }
            };
            xhttp.open("GET", '/Comment/GetComments?postId=' + hiddenValue, true);
            xhttp.send();
        });

        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        })
    </script>
}